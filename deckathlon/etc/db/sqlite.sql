-- Schema for SQLite.
--
-- ------------------------------------------------------------------------------
-- This file is part of Deckathlon - card game website.
-- Released under the MIT License.
--
-- @author    Erki Suurjaak
-- @created   08.05.2020
-- @modified  21.05.2020

CREATE TABLE IF NOT EXISTS users (
  id         INTEGER   PRIMARY KEY AUTOINCREMENT NOT NULL,
  username   TEXT      NOT NULL CHECK (LENGTH(username) > 0),
  password   TEXT      NOT NULL CHECK (LENGTH(password) > 0),
  dt_created TIMESTAMP NOT NULL DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now')),
  dt_changed TIMESTAMP NOT NULL DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now'))
);


CREATE TABLE IF NOT EXISTS games (
  id         INTEGER   PRIMARY KEY AUTOINCREMENT NOT NULL,
  fk_table   INTEGER   NOT NULL REFERENCES tables (id),
  fk_player  INTEGER   REFERENCES players (id),
  series     INTEGER   NOT NULL DEFAULT 0,
  sequence   INTEGER   NOT NULL DEFAULT 0,
  status     TEXT      NOT NULL DEFAULT 'new',
  opts       JSON      NOT NULL DEFAULT '{}',
  deck       JSON      NOT NULL DEFAULT '[]',
  hands      JSON      NOT NULL DEFAULT '{}',
  talon      JSON      NOT NULL DEFAULT '[]',
  talon0     JSON      NOT NULL DEFAULT '[]',
  bids       JSON      NOT NULL DEFAULT '[]',
  bid        JSON      NOT NULL DEFAULT '{}',
  tricks     JSON      NOT NULL DEFAULT '[]',
  trick      JSON      NOT NULL DEFAULT '[]',
  moves      JSON      DEFAULT '[]',
  discards   JSON      NOT NULL DEFAULT '[]',
  score      JSON      NOT NULL DEFAULT '{}',
  dt_created TIMESTAMP NOT NULL DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now')),
  dt_changed TIMESTAMP NOT NULL DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now'))
);


CREATE TABLE IF NOT EXISTS log (
  id         INTEGER   PRIMARY KEY AUTOINCREMENT NOT NULL,
  fk_user    INTEGER   REFERENCES users (id),
  action     TEXT,
  data       JSON,
  dt_created TIMESTAMP DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now'))
);


CREATE TABLE IF NOT EXISTS online (
  id         INTEGER   PRIMARY KEY AUTOINCREMENT NOT NULL,
  fk_user    INTEGER   NOT NULL REFERENCES users (id),
  fk_table   INTEGER   REFERENCES tables (id),
  active     INTEGER   NOT NULL DEFAULT 1,
  dt_online  TIMESTAMP DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now')),
  dt_created TIMESTAMP NOT NULL DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now')),
  dt_changed TIMESTAMP NOT NULL DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now')),
  UNIQUE (fk_user, fk_table)
);


CREATE TABLE IF NOT EXISTS players (
  id         INTEGER   PRIMARY KEY AUTOINCREMENT NOT NULL,
  fk_table   INTEGER   NOT NULL REFERENCES tables (id),
  fk_game    INTEGER   REFERENCES games (id),
  fk_user    INTEGER   REFERENCES users (id),
  sequence   INTEGER   NOT NULL DEFAULT 0,
  status     TEXT,
  expected   JSON      DEFAULT '{}',
  hand       JSON      NOT NULL DEFAULT '[]',
  hand0      JSON      NOT NULL DEFAULT '[]',
  moves      JSON      NOT NULL DEFAULT '[]',
  tricks     JSON      NOT NULL DEFAULT '[]',
  dt_created TIMESTAMP NOT NULL DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now')),
  dt_changed TIMESTAMP NOT NULL DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now')),
  dt_deleted TIMESTAMP
);


CREATE TABLE IF NOT EXISTS requests (
  id         INTEGER   PRIMARY KEY AUTOINCREMENT NOT NULL,
  fk_user    INTEGER   NOT NULL REFERENCES users (id),
  fk_table   INTEGER   NOT NULL REFERENCES tables (id),
  fk_game    INTEGER   REFERENCES games (id),
  type       TEXT      NOT NULL,
  status     TEXT      NOT NULL DEFAULT 'new',
  opts       JSON      NOT NULL DEFAULT '{}',
  public     INTEGER   NOT NULL DEFAULT 0,
  dt_created TIMESTAMP NOT NULL DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now')),
  dt_changed TIMESTAMP NOT NULL DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now'))
);


CREATE TABLE IF NOT EXISTS table_users (
  id         INTEGER   PRIMARY KEY AUTOINCREMENT NOT NULL,
  fk_table   INTEGER   NOT NULL REFERENCES tables (id),
  fk_user    INTEGER   NOT NULL REFERENCES users (id),
  dt_created TIMESTAMP NOT NULL DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now')),
  dt_changed TIMESTAMP NOT NULL DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now')),
  dt_deleted TIMESTAMP
);


CREATE TABLE IF NOT EXISTS tables (
  id             INTEGER   PRIMARY KEY AUTOINCREMENT NOT NULL,
  fk_creator     INTEGER   NOT NULL REFERENCES users (id),
  fk_host        INTEGER   NOT NULL REFERENCES users (id),
  fk_template    INTEGER   NOT NULL REFERENCES templates (id),
  name           TEXT      NOT NULL,
  shortid        TEXT      NOT NULL,
  public         INTEGER   NOT NULL DEFAULT 0,
  opts           JSON      NOT NULL DEFAULT '{}',
  series         INTEGER   NOT NULL DEFAULT 0,
  games          INTEGER   NOT NULL DEFAULT 0,
  players        INTEGER   NOT NULL DEFAULT 0,
  status         TEXT      DEFAULT 'new',
  bids           JSON      NOT NULL DEFAULT '[]',
  scores         JSON      NOT NULL DEFAULT '[]',
  bids_history   JSON      NOT NULL DEFAULT '[]',
  scores_history JSON      NOT NULL DEFAULT '[]',
  dt_created     TIMESTAMP NOT NULL DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now')),
  dt_changed     TIMESTAMP NOT NULL DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now')),
  dt_deleted     TIMESTAMP
);


CREATE TABLE IF NOT EXISTS templates (
  id          INTEGER   PRIMARY KEY AUTOINCREMENT NOT NULL,
  fk_creator  INTEGER   REFERENCES users (id),
  name        TEXT      NOT NULL CHECK (LENGTH(name) > 0),
  opts        JSON      NOT NULL DEFAULT '{}',
  description TEXT      NOT NULL DEFAULT '',
  dt_created  TIMESTAMP NOT NULL DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now')),
  dt_changed  TIMESTAMP NOT NULL DEFAULT (STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now')),
  dt_deleted  TIMESTAMP
);


CREATE TRIGGER IF NOT EXISTS on_update_games AFTER UPDATE ON games
BEGIN
UPDATE games SET dt_changed = STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now') WHERE id = NEW.id;
END;


CREATE TRIGGER IF NOT EXISTS on_update_online AFTER UPDATE ON online
BEGIN
UPDATE online SET dt_changed = STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now') WHERE id = NEW.id;
END;


CREATE TRIGGER IF NOT EXISTS on_update_players AFTER UPDATE ON players
BEGIN
UPDATE players SET dt_changed = STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now') WHERE id = NEW.id;
END;


CREATE TRIGGER IF NOT EXISTS on_update_requests AFTER UPDATE ON requests
BEGIN
UPDATE requests SET dt_changed = STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now') WHERE id = NEW.id;
END;


CREATE TRIGGER IF NOT EXISTS on_update_tables AFTER UPDATE ON tables
BEGIN
UPDATE tables SET dt_changed = STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now') WHERE id = NEW.id;
END;


CREATE TRIGGER IF NOT EXISTS on_update_templates AFTER UPDATE ON templates
BEGIN
UPDATE templates SET dt_changed = STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now') WHERE id = NEW.id;
END;


CREATE TRIGGER IF NOT EXISTS on_update_users AFTER UPDATE ON users
BEGIN
UPDATE users SET dt_changed = STRFTIME('%Y-%m-%d %H:%M:%f000+00:00', 'now') WHERE id = NEW.id;
END;


INSERT OR IGNORE INTO templates (id, name, opts, description, dt_created, dt_changed) VALUES (1, 'Thousand', '{"sort": ["suite", "level"], "suites": "HSDC", "trump": true, "lead": {"0": "bidder", "*": "trick"}, "talon": {"face": false}, "move": {"win": {"suite": true, "level": true}, "pass": false, "cards": 1, "crawl": 0, "response": {"suite": {"trump": "optional"}}, "special": {"wheels": {"0": false, "*": [["AD", "0D"], ["AH", "0H"], ["AS", "0S"], ["AC", "0C"]], "condition": {"opt": "trump", "suite": true}}, "trump": {"0": false, "*": [["KD", "QD"], ["KH", "QH"], ["KS", "QS"], ["KC", "QC"]], "condition": {"cards": 3}}}}, "reveal": true, "hand": 7, "trick": true, "players": [3, 4], "complete": {"score": 1000}, "levels": "9JQK0A", "bidding": {"sell": true, "blind": true, "min": 60, "max": {"blind": 120, "*": 120, "trump": 340}, "distribute": true, "pass_final": true, "talon": true, "step": 5, "pass": true}, "pass": false, "cards": ["9S", "9H", "9D", "9C", "JS", "JH", "JD", "JC", "QS", "QH", "QD", "QC", "KS", "KH", "KD", "KC", "0S", "0H", "0D", "0C", "AS", "AH", "AD", "AC"], "redeal": {"reveal": true, "condition": {"min": 3, "hand": ["9H", "9S", "9D", "9C"]}}, "points": {"trick": {"A": 11, "K": 4, "J": 2, "Q": 3, "0": 10, "9": 0}, "bidonly": {"min": 900}, "bonuses": {"blind": {"value": 2, "op": "mul"}}, "penalties": {"blind": {"value": -2, "op": "mul"}, "nochange": {"op": "add", "value": -100, "times": 3}, "bid": {"value": -1, "op": "mul"}}, "special": {"wheels": 120, "trump": {"C": 100, "H": 60, "S": 80, "D": 40}}}}', X'4120747269636B2D74616B696E672067616D6520666F7220332D3420706C61796572732C207769746820612062696464696E6720706861736520616E64206120706C6179696E672070686173652E200A506C6179656420776974682061206465636B206F662032342063617264732C2066726F6D206E696E657320746F20616365732E2054686520676F616C20697320746F206265207468650A666972737420706C617965722077686F2072656163686573203130303020706F696E74732E0A0A5665727920656E676167696E672C20686967686C7920706F70756C617220696E204561737465726E204575726F70652E2043616E206C61737420666F7220686F7572732C0A726172656C79206C657373207468616E206F6E6520686F75722E0A0A0A2323232042696464696E670A0A4465636B206973206465616C74206F757420746F20706C617965727320283720636172647320746F2065616368206966203320706C61796572732C2036206361726473206966203420706C6179657273292C0A77697468207468652072656D61696E64657220676F696E6720746F2074616C6F6E20666163652D646F776E0A2833206361726473206966203320706C61796572732C2034206361726473206966203420706C6179657273292E20506C617965727320636C6F636B7769736520737461727420706C6163696E67200A74686569722062696473206261736564206F6E2074686569722068616E643A20686F77206D616E7920706F696E74732077696C6C2074686579206D616B65206966207468657920676574200A7468652074616C6F6E2E204D696E696D756D2062657420697320363020706F696E74732C2064656661756C74206D6178696D756D2069732031323020706F696E74732C200A6F722068696768657220696620706C6179657220686173207472756D7020636172647320696E2068616E642E0A0A42696464696E67206973206E6F74206D616E6461746F72792C20706C617965722063616E20706173732E200A50617373696E6720647572696E672062696464696E672069732066696E616C202D20706C617965722063616E20626964206E6F206D6F72652E200A0A496620616C6C20706C6179657273207061737320776974686F75742062696464696E672C206465636B2069732072652D6465616C742E0A0A4966206120706C6179657220686173206174206C656173742033206E696E657320696E2074686569722068616E642C20746865792063616E2064656D616E6420612072652D6465616C200A6F6E207468656972206669727374206269642E0A0A0A2323232320426C696E640A0A4120706C617965722063616E20626964205F626C696E645F2C20776974686F7574206C6F6F6B696E672061742074686569722068616E642E204966207468657920737563636565640A696E206D616B696E672074686174206D616E7920706F696E747320696E2067616D652C20746865792077696C6C2067657420646F75626C652074686520706F696E74732E2049662074686579206661696C2C0A746865792077696C6C2067657420646F75626C6520746865206D696E757320706F696E74732E20546865206D6178696D756D20626C696E64206265742069732031323020706F696E74732E0A0A0A232323232053656C6C696E670A0A496620706C617965722077686F20776F6E207468652074616C6F6E2C2073656573207468652074616C6F6E20636172647320616E64207468696E6B7320746865792077696C6C206E6F74200A7375636365656420696E206D616B696E672074686520706F696E74732074686579206269642C20746865792063616E205F73656C6C5F207468652074616C6F6E2E0A54616C6F6E20636172647320676F206261636B206F6E207461626C652C20666163652D757020746869732074696D652C20616E6420706C61796572732063616E20636F6E74696E7565200A62696464696E6720666F72207468652074616C6F6E2C207374617274696E67207769746820706C61796572206E65787420746F207468652073656C6C65722E200A506C61796572732077686F20706173736564207468652066697273742074696D652063616E20616C736F2070617274696369706174652E0A5468652073656C6C696E6720706C617965722063616E20616C736F20706172746963697061746520696620736F6D65626F6479206F7665726269647320746865697220696E697469616C0A6E756D6265722E200A0A496620616E6F7468657220706C617965722062757973207468652074616C6F6E2C207468652073656C6C65722067657473206E6F2070656E616C74792E0A4966206E6F626F64792077616E747320746F20627579207468652074616C6F6E2C207468652073656C6C65722073696D706C7920636F6E74696E756573206173207468657920776572652C0A77697468207468652074616C6F6E206261636B20696E2074686569722068616E642E200A0A54616C6F6E2063616E6E6F742062652072652D736F6C642E0A0A0A23232320446973747269627574696E670A0A4F6E6365206120706C617965722068617320776F6E207468652062696464696E672C20746865792072656365697665207468652074616C6F6E20636172647320696E746F2074686569722068616E642E0A54686579206E6F77206E65656420746F2067697665206F6E6520667265656C792063686F73656E20636172642066726F6D2074686569722068616E6420746F2065616368206F7468657220706C617965722C0A736F207468617420616C6C20706C61796572732068617665207468652073616D6520616D6F756E74206F662063617264732E200A0A5768656E20706C6179696E672077697468207265616C2063617264732C2074686520706C617965722077686F20776F6E207468652074616C6F6E20616C77617973206E6565647320746F0A72656D656D62657220746861742074686579206861766520746F206469737472696275746520636172647320746F206F7468657220706C61796572732E204966207468657920666F726765740A616E6420666F7220696E7374616E636520706C617920616E2061636520617320746865207479706963616C206669727374206D6F76652C20666163652075702C0A7468656E20746865206E65787420706C617965722063616E2074616B6520746861742061636520696E746F2074686569722068616E642061732061206361726420646973747269627574656420746F207468656D2E0A0A0A23232320506C6179696E670A0A506C617965722077686F20776F6E207468652074616C6F6E2C206C656164732074686520666972737420747269636B20616E6420706C617973206120636172642E200A4561636820706C6179657220636C6F636B77697365206E6565647320746F20706C6179206F6E65206361726420696E20726573706F6E73652C200A73616D65207375697465206966207468657920686176652069742C20616E79207375697465206F74686572776973652E200A54686520706C617965722077686F20706C617965642074686520746F702072616E6B696E67206361726420696E20746865206C656164696E672073756974652C200A77696E732074686520747269636B20616E642063616E20737461727420746865206E65787420747269636B2E0A0A506C6179696E6720612063617264206F6620616E6F7468657220737569746520696E20726573706F6E7365206C6F7365732074686520747269636B206175746F6D61746963616C6C792C0A7265676172646C657373206F66207468652063617264206C6576656C2028652E672E20616365206F662073706164657320646F6573206E6F7420626561742061206C656164696E67206E696E65206F6620686561727473292E0A556E6C65737320706C6179657220706C6179732061207472756D7020636172643A207472756D702073756974652074616B657320707265636564656E6365206F766572206C656164696E672073756974652E0A0A436172642072616E6B696E672069733A2061636520617320686967686573742C2074656E2C206B696E672C20717565656E2C206A61636B2C206E696E65206173206C6F776573742E0A0A4F6E6C7920746865206C61737420747269636B2074616B656E2063616E206265206C6F6F6B656420617420616674657277617264732C207768696C652067616D6520697320756E6465727761792E0A0A0A2323232320437261776C696E670A0A4966207468652062696464696E6720706C6179657220686173206E6F206163657320696E2068616E642C20746865792063616E205F637261776C5F206F6E207468656972206669727374206D6F76653A0A706C61792061206361726420666163652D646F776E2E204576657279206F7468657220706C6179657220706C6179732074686569722063617264206661636520646F776E2061732077656C6C2C0A747269636B206973207374696C6C20776F6E2062792077686F6576657220706C617965642074686520746F70206361726420696E20636F6E74657874206F662074686520666972737420636172642E0A0A0A232323205472756D700A0A496620706C61796572206C656164696E672074686520747269636B206861732074616B656E206174206C65617374206F6E6520747269636B20616C72656164792C0A686173206174206C6561737420746872656520636172647320696E2068616E642C20616E642068617320746865206B696E6720616E6420717565656E206F66206F6E6520737569746520696E2068616E642C0A746865792063616E206D616B652061205F7472756D705F3A20706C6179206F6E65206F66207468652074776F20636172647320616E64206465636C61726520227472756D70222E0A46726F6D2074686174206D6F6D656E74206F6E2C2074686973207375697465207472756D7073206F74686572207375697465732E0A0A4D756C7469706C65207472756D70732063616E206265206D61646520647572696E67206F6E652067616D652C200A6E657874207472756D70206F7665727269646573207468652070726576696F7573206F6E652E0A0A0A2323232320576865656C730A0A4164646974696F6E616C6C792C20696620706C61796572206C656164696E672074686520747269636B20686173207468652061636520616E642074656E200A6F66207468652063757272656E74207472756D7020737569746520696E2068616E6420287265676172646C657373206F662077686F206D61646520746865207472756D70292C0A746865792063616E206D616B65205F776865656C735F3A20706C6179206F6E65206F66207468652074776F20636172647320616E64206465636C6172652022776865656C73222E0A546869732077696C6C2067697665207468656D20616E206164646974696F6E616C2031323020706F696E74732E0A0A0A23232320506F696E74730A0A5768656E20616C6C2068616E64732068617665206265656E20706C617965642C20706C61796572732074616C6C7920757020746865697220706F696E74732E204561636820747269636B2074616B656E0A6769766573207468656D20706F696E74732066726F6D2074686520636172647320696E20747269636B3A0A0A2D206163653A2020313120706F696E74730A2D2074656E3A2020313020706F696E74730A2D206B696E673A20203420706F696E74730A2D20717565656E3A203320706F696E74730A2D206A61636B3A20203220706F696E74730A2D206E696E653A20203020706F696E74730A0A54686520746F74616C2074616C6C792066726F6D20616C6C2063617264732069732031323020706F696E74732E0A0A45616368207472756D702074686174206120706C61796572206D616B6573206769766573207468656D20706F696E7473206163636F7264696E6720746F207468652073756974653A0A0A2D20636C7562733A20202031303020706F696E74730A2D207370616465733A202020383020706F696E74730A2D206865617274733A202020363020706F696E74730A2D206469616D6F6E64733A20343020706F696E74730A0A576865656C73206769766520706C617965722031323020706F696E74732E200A0A54686520706C617965722077686F20776F6E207468652074616C6F6E2C20676574732074686520657861637420616D6F756E74206269642069662074686579207375636365656420696E206D616B696E670A6174206C656173742074686174206D616E7920706F696E74732E204D616B696E67206D6F726520646F6573206E6F742067697665207468656D206D6F726520706F696E74732E0A49662074686520706C61796572206661696C73206174206D616B696E67206173206D616E7920706F696E74732074686579206269642C20746865792077696C6C20676574206D696E75732074686520616D6F756E742E0A0A4F7468657220706C61796572732077696C6C20676574206173206D616E7920706F696E747320617320746865697220747269636B7320616E64207472756D7073206574632067697665207468656D2E0A0A4966206120706C61796572277320706F696E742073636F726520686173206E6F74206368616E67656420666F722074687265652067616D657320696E206120726F772C20746865792077696C6C206C6F73650A31303020706F696E74732E20506F696E74732063616E20676F2062656C6F77207A65726F20776974686F7574206C696D69742E200A0A5768696C65206120706C617965722068617320612073636F7265206F662039303020706F696E7473206F72206869676865722C20746865792063616E206F6E6C792072656365697665206D6F726520706F696E74730A696620746865792062696420616E64207375636365656420696E206D656574696E67207468656972206269643B20746865792077696C6C20676574206E6F20706F696E7473206F74686572776973652C0A7265676172646C657373206F6620686F77206D616E7920747269636B7320616E64207472756D707320746865792074616B6520616E64206D616B652E', '2020-04-18 22:07:23.000000+00:00', '2020-05-21 18:54:00.166000+00:00');

INSERT OR IGNORE INTO templates (id, name, opts, description, dt_created, dt_changed) VALUES (2, 'Arschloch', '{"sort": "level", "suites": "HSDCX", "lead": {"0": {"ranking": -1}, "*": "trick"}, "discards": true, "move": {"cards": "*", "win": {"last": true, "level": "all"}, "pass": true, "response": {"amount": true, "level": true}, "level": true}, "hand": 19, "players": [3, 7], "ranking": {"finish": true}, "nextgame": {"distribute": {"ranking": true, "max": 3}}, "cards": ["3S", "3H", "3D", "3C", "4S", "4H", "4D", "4C", "5S", "5H", "5D", "5C", "6S", "6H", "6D", "6C", "7S", "7H", "7D", "7C", "8S", "8H", "8D", "8C", "9S", "9H", "9D", "9C", "0S", "0H", "0D", "0C", "JS", "JH", "JD", "JC", "QS", "QH", "QD", "QC", "KS", "KH", "KD", "KC", "AS", "AH", "AD", "AC", "2S", "2H", "2D", "2C", "XX", "YX", "ZX"], "levels": "34567890JQKA2X", "reveal": false}', X'412067616D6520666F7220332D3720706C61796572732C20776974682077696E6E65727320616E64206C6F736572732065786368616E67696E6720636172647320696E20636F6E73656375746976652067616D65732E200A506C61796564207769746820612066756C6C206465636B206F662035352063617264732C20616C6C2063617264732066726F6D2074776F7320746F206163657320746F206A6F6B6572732E20496E2065616368200A67616D65207365742C2074686520676F616C20697320746F20656D707479206F776E2068616E642066697273743B20706C617965722066696E697368696E6720666972737420697320746865200A77696E6E657220616E6420706C617965722066696E697368696E67206C61737420746865206C6F7365722E200A0A342D3520706C6179657273206D616B657320666F72206F7074696D756D2067616D65706C61792E200A0A53696D706C652072756C65732C20686967686C792061646469637469766520616E6420656E676167696E672E2047616D65207365726965732063616E206C61737420666F7220686F7572732C200A6F7220626520686164206173206120717569636B20656E7465727461696E6D656E7420647572696E67206120627265616B2E200A0A4B6E6F776E206279206D616E79206F74686572206E616D65733A20417373686F6C652C204361706974616C69736D2C20507265736964656E742C205363756D2E200A0A0A23232320506C6179696E670A0A456E74697265206465636B206973206465616C74206F757420746F20616C6C20706C61796572732028696E6576697461626C7920756E6576656E6C792C20756E6C6573732074686572650A6172652065786163746C79203520706C6179657273292E20496E2066697273742067616D6520696E207365726965732C2074686520706C61796572206E65787420746F206465616C6572200A6C656164732074686520666972737420747269636B2C20696E20666F6C6C6F77696E672067616D657320746865206C6F736572206F66207468652070726576696F75732067616D65200A6C656164732074686520666972737420747269636B2E200A0A506C61796572206C65616473206120747269636B20627920706C6179696E6720612073696E676C65206F722070616972206F7220747269706C65206F7220717561647275706C650A6F662061206B696E642C20652E672E2033206E696E65732E204E65787420706C617965727320636C6F636B77697365206E65656420746F20706C61792074686569722063617264730A73696D696C61726C7920616C6C206F66206F6E65206C6576656C2C206174206C65617374207468652073616D6520616D6F756E74206F662063617264732C200A6174206C65617374207468652073616D65206C6576656C2E205375697465732061726520697272656C6576616E742E200A506C617965722063616E20706173733B206F6E6365207061737365642C20746865792063616E20706C6179206E6F206D6F726520647572696E67207468697320747269636B2E0A0A496620616C6C20706C61796572732068617665207061737365642065786365707420746865206F6E652077686F20706C61796564206C6173742C200A74686520747269636B2069732064697363617264656420616E6420746865206C61737420706C617965722063616E206C65616420746865206E65787420747269636B2E0A0A496620616C6C206361726473206F66206F6E65206C6576656C206D65657420696E206F6E6520747269636B2028666F7572206F662061206B696E64206F72207468726565206A6F6B657273292C0A74686520747269636B2069732064697363617264656420616E6420746865206C61737420706C617965722063616E206C65616420746865206E65787420747269636B2E0A0A436172642072616E6B696E672069733A206A6F6B657220617320686967686573742C2074776F2C206163652C206B696E672C20717565656E2C206A61636B2C2074656E2C206E696E652C200A2E2E2C20666F75722C207468726565206173206C6F776573742E0A0A4F6E6C7920746865206C61737420747269636B206469736361726465642063616E206265206C6F6F6B656420617420616674657277617264732C207768696C652067616D6520697320756E6465727761792E0A0A0A2323232045786368616E67696E670A0A496E20636F6E73656375746976652067616D65732C20746865206869676820616E64206C6F772072616E6B696E6720706C6179657273206F66207468652070726576696F75732067616D65200A65786368616E676520636172647320616D6F6E67207468656D73656C7665732C2077697468206C6F772072616E6B73206E656564696E6720746F206769766520746865697220746F70206361726473200A616E6420686967682072616E6B732061626C6520746F206769766520616E7920636172647320746865792063686F6F73652E20466972737420616E64206C61737420706C61796572200A65786368616E676520332063617264732C20667572746865722072616E6B732065786368616E6765206F6E652063617264206C6573732070657220737465702E2057697468206174206C656173740A3420706C61796572732C207365636F6E64206265737420616E64207365636F6E64206C6173742065786368616E676520322063617264732E2057697468206174206C65617374203620706C61796572732C200A7468697264206265737420616E64207468697264206C6173742065786368616E6765203120636172642E200A0A5769746820616E206F6464206E756D62657220706C61796572732C2074686520706C61796572206174206578616374206D6964646C652072616E6B2065786368616E6765732077697468206E6F206F6E652E0A0A5768656E20706C6179696E672077697468207265616C2063617264732C20746865206C6F736572206E6565647320746F206465616C2E200A0A0A23232320436F6D6D656E740A0A417320737563682C2074686520746F702D72616E6B696E6720706C617965727320636F6E74696E756520746F20646F6D696E61746520666F6C6C6F77696E672067616D65732C200A73696E636520746865792063616E206E6F74206F6E6C7920676976652061776179206C6F772063617264732C2062757420666F637573206F6E2067657474696E6720726964206F66200A73696E676C6573202D20696E206164646974696F6E20746F20726563656976696E672068696768206361726473206261636B2E204F6674656E74696D6573200A7468652066697273742068616C66206F66207468652067616D652069732074686520746F702072616E6B73206669676874696E672065616368206F7468657220756E74696C20746865792066696E6973682C0A617320746865206C6F73696E6720706C61796572732073696D706C7920646F6E27742068617665206173206D616E79206869676820636172647320616E64206D756C7469706C657320746F20706C61792E200A0A546865206F6E6C7920616476616E746167657320666F7220746865206C6F73696E6720706C61796572206172653A20746865792063616E206C6561642074686520666972737420747269636B2C200A616E6420646570656E64696E67206F6E20746865206E756D626572206F6620706C617965727320746865792074656E6420746F20676574206F6E652063617264206C6573732E0A0A57686F2065786163746C79206973207468652041727363686C6F63682068657265202D207468652077696E6E6572206F7220746865206C6F736572202D206973206D6174746572206F66206465626174652E20', '2020-05-03 19:46:23.843000+00:00', '2020-05-08 21:10:13.930000+00:00');

INSERT OR IGNORE INTO templates (id, name, opts, description, dt_created, dt_changed) VALUES (3, 'Five Sheets', '{"sort": ["suite", "level"], "suites": "HSDC", "trump": true, "ranking": {"finish": true}, "talon": {"trump": true, "lead": true, "face": false}, "move": {"cards": 1, "follow": {"cards": 1}, "response": {"suite": {"trump": "alternative"}, "level": true}, "retreat": {"uptake": {"stack": 5}}}, "hand": 5, "players": [2, 8], "levels": "2345678909JQKA", "cards": ["2H", "2S", "2D", "2C", "3H", "3S", "3D", "3C", "4H", "4S", "4D", "4C", "5H", "5S", "5D", "5C", "6H", "6S", "6D", "6C", "7H", "7S", "7D", "7C", "8H", "8S", "8D", "8C", "9H", "9S", "9D", "9C", "0H", "0S", "0D", "0C", "JH", "JS", "JD", "JC", "QH", "QS", "QD", "QC", "KH", "KS", "KD", "KC", "AH", "AS", "AD", "AC"], "refill": true, "stack": true}', X'412073696D706C652067616D6520666F7220322D3820706C61796572732C207769746820706C6179657273206E656564696E6720746F206B696C6C207468652070726576696F7573200A6361726420616E6420706C61792061206361726420666F7220746865206E65787420706C6179657220746F206B696C6C2E20506C6179656420776974682061206465636B206F66203532200A63617264732C2066726F6D2074776F7320746F20616365732E2054686520676F616C20697320746F20656D707479206F776E2068616E642066697273743B20706C617965722066696E697368696E67200A6669727374206973207468652077696E6E657220616E6420706C617965722066696E697368696E67206C61737420746865206C6F7365722E0A0A0A23232320506C6179696E670A0A4561636820706C61796572206973206465616C7420352063617264732C207468652072656D61696E64657220676F696E6720746F2074616C6F6E20666163652D646F776E2C2077697468200A6F6E6520636172642062656C6F772074616C6F6E20666163652D757020617320746865207472756D702C20616E64206F6E65206361726420696E207461626C6520737461636B20666163652D7570200A617320746865206C6561642E0A0A506C61796572206E65787420746F20746865206465616C6572206C6561647320627920706C6179696E672061206361726420746F20737461636B2074686174206B696C6C7320746865206C617374200A6361726420696E20737461636B2C20616E6420666F6C6C6F7773206974207769746820616E6F74686572206361726420666F7220746865206E65787420706C6179657220746F206B696C6C2E200A4120636172642063616E206265206B696C6C6564206279206120686967686572206361726420696E2073616D652073756974652C206F722061206361726420696E207472756D702073756974652E200A5472756D702063616E20626520706C61796564206576656E20696620706C61796572206861732068696768657220636172647320696E2073616D652073756974652E0A0A4166746572206D616B696E67207468656972206D6F76652C20706C6179657220726566696C6C732074686569722068616E642062792074616B696E67206E65772063617264732066726F6D200A74616C6F6E20756E74696C20746865792068617665203520696E2068616E642E2054686520666163652D7570207472756D7020636172642062656C6F772074616C6F6E20676574732074616B656E200A7570206C6173742E200A0A496620706C617965722063616E6E6F74206F722063686F6F736573206E6F7420746F206B696C6C20746865206C617374206361726420696E20737461636B2C2074686579206E65656420746F200A726574726561742062792074616B696E6720757020746F20352063617264732066726F6D20737461636B20696E746F2068616E642E20496620737461636B206765747320656D7074696564200A647572696E67206120726574726561742C2061206E6577206361726420697320706C617965642066726F6D2074616C6F6E20746F20737461636B2E20496620626F746820737461636B20616E64200A74616C6F6E2061726520656D7074792C20746865206E65787420706C61796572206F6E6C79206E6565647320746F20706C617920612073696E676C6520636172642E200A0A496620706C617965722068617320612073696E676C65206361726420696E2068616E642C207468657920646F206E6F74206E65656420746F20706C61792074686520666F6C6C6F7720636172642E200A0A436172642072616E6B696E672069733A2061636520617320686967686573742C206B696E672C20717565656E2C206A61636B2C2074656E2C202E2E2C2074687265652C2074776F206173206C6F776573742E', '2020-05-20 09:49:39.140000+00:00', '2020-05-21 18:54:00.256000+00:00');
